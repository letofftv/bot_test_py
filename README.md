# Психологический Telegram Бот

Telegram бот для психологических консультаций и создания психологических карт с использованием OpenAI GPT-4.

## Функциональность

### Для пользователей:
1. **Психологическая консультация** - получение профессиональной консультации от ИИ-психолога
2. **Создание психологической карты** - прохождение опроса и получение персональной психологической карты

### Для администратора:
- Модерация созданных карт
- Одобрение/отклонение карт
- Отправка результатов пользователям

## Структура проекта

```
bot_test_py/
├── run.py                 # Основной файл для запуска на хостинге
├── run_admin.py           # Файл для запуска админской панели
├── bot_polling.py         # Основной бот (polling)
├── admin_polling.py       # Админская панель (polling)
├── config.py              # Конфигурация и настройки
├── database.py            # Работа с базой данных
├── openai_client.py       # Интеграция с OpenAI API
├── requirements.txt       # Зависимости Python
├── database.json          # База данных (создается автоматически)
└── README.md             # Документация
```

## Установка и настройка

### 1. Установка зависимостей
```bash
pip install -r requirements.txt
```

### 2. Настройка переменных окружения

Создайте файл `.env` или установите переменные окружения:

```env
BOT_TOKEN=ваш_telegram_токен
OPENAI_API_KEY=ваш_openai_ключ
```

### 3. Запуск бота

#### Локальная разработка:
```bash
# Основной бот
python3 bot_polling.py

# Админская панель (в отдельном терминале)
python3 admin_polling.py
```

#### На хостинге:
```bash
# Основной бот
python3 run.py

# Админская панель
python3 run_admin.py
```

## Развертывание на хостинге

### 1. Подготовка файлов
Убедитесь, что у вас есть все необходимые файлы:
- `run.py` - основной файл запуска
- `run_admin.py` - файл запуска админской панели
- `requirements.txt` - зависимости
- `.env` - переменные окружения

### 2. Настройка переменных окружения
На хостинге установите переменные окружения:
- `BOT_TOKEN` - токен Telegram бота
- `OPENAI_API_KEY` - ключ OpenAI API

### 3. Запуск
```bash
# Установка зависимостей
pip install -r requirements.txt

# Запуск основного бота
python3 run.py
```

## Использование

### Для пользователей:
1. Отправьте `/start` боту
2. Выберите нужную опцию:
   - "1️⃣ Получить консультацию" - для консультации
   - "2️⃣ Создать психологическую карту" - для создания карты

### Для администратора:
- `/admin` - открыть админ-панель
- `/pending` - показать карты на модерации
- Используйте кнопки для одобрения/отклонения карт

## База данных

Данные хранятся в JSON файле `database.json`:
- Состояния пользователей
- Психологические карты
- Статусы модерации

## Безопасность

- Все чувствительные данные хранятся в переменных окружения
- Проверка прав доступа для админских функций
- Модерация контента через OpenAI API

## Логирование

Все действия логируются с указанием времени и уровня важности.

## Поддержка

При возникновении проблем проверьте:
1. Правильность токенов в переменных окружения
2. Доступность OpenAI API
3. Логи приложения для диагностики ошибок

## Исправления

### Проблема с нейросетью:
- Исправлены асинхронные вызовы в `openai_client.py`
- Методы теперь синхронные и работают корректно
- Убраны лишние файлы для чистоты проекта 
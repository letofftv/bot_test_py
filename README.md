# Психологический Telegram Бот

Telegram бот для психологических консультаций и создания психологических карт. Работает полностью офлайн без внешних API.

**Версия:** v1.1 (Стабильный релиз)  
**Дата:** Декабрь 2024

## Функциональность

### Для пользователей:
1. **Психологическая консультация** - получение консультации от ИИ-психолога
2. **Создание психологической карты** - прохождение опроса и получение персональной психологической карты (15 различных типов карт)

### Для администраторов:
- Модерация созданных карт
- Одобрение/отклонение карт
- Получение всех сообщений пользователей
- Отправка результатов пользователям

## Структура проекта

```
bot_test_py/
├── run.py                 # Основной файл для запуска на хостинге
├── run_admin.py           # Файл для запуска админской панели
├── bot_polling.py         # Основной бот (polling)
├── admin_polling.py       # Админская панель (polling)
├── config.py              # Конфигурация и настройки
├── database.py            # Работа с базой данных
├── local_responses.py     # Локальная система ответов
├── psychological_maps.py  # 15 психологических карт с вопросами
├── requirements.txt       # Зависимости Python
├── database.json          # База данных (создается автоматически)
├── deploy.sh             # Скрипт развертывания
├── restart_with_monitoring.sh # Скрипт перезапуска с мониторингом
├── stop_bot.sh           # Скрипт остановки бота
├── HOSTING.md            # Инструкции по хостингу
└── README.md             # Документация
```

## Психологические карты

Бот поддерживает 15 различных типов психологических карт:

1. **Внутренние роли** - анализ внутренних конфликтов и ролей
2. **Эмоциональный интеллект** - оценка способности понимать и управлять эмоциями
3. **Коммуникативные стили** - анализ способов общения
4. **Ценностные ориентации** - определение жизненных приоритетов
5. **Стили принятия решений** - анализ подходов к выбору
6. **Типы мотивации** - определение движущих сил
7. **Стратегии совладания** - анализ способов преодоления трудностей
8. **Социальные роли** - исследование межличностных отношений
9. **Когнитивные стили** - анализ способов мышления
10. **Творческий потенциал** - оценка креативности
11. **Лидерские качества** - анализ лидерских способностей
12. **Стрессоустойчивость** - оценка устойчивости к стрессу
13. **Самооценка** - анализ отношения к себе
14. **Жизненные цели** - определение направлений развития
15. **Типы личности** - общая характеристика личности

Каждая карта имеет:
- Подробное описание
- Базовый набор вопросов (5-7 вопросов)
- Расширенный набор вопросов (10-15 вопросов)

## Установка и настройка

### 1. Установка зависимостей
```bash
pip install -r requirements.txt
```

### 2. Настройка переменных окружения

Создайте файл `.env` или установите переменные окружения:

```env
BOT_TOKEN=ваш_telegram_токен
ADMIN_IDS=196035876,123456789
```

**ADMIN_IDS** - список ID администраторов через запятую (без пробелов)

### 3. Запуск бота

#### Локальная разработка:
```bash
# Основной бот
python3 bot_polling.py

# Админская панель (в отдельном терминале)
python3 admin_polling.py
```

#### На хостинге:
```bash
# Основной бот
python3 run.py

# Админская панель
python3 run_admin.py
```

## Развертывание на хостинге

### 1. Подготовка файлов
Убедитесь, что у вас есть все необходимые файлы:
- `run.py` - основной файл запуска
- `run_admin.py` - файл запуска админской панели
- `requirements.txt` - зависимости
- `.env` - переменные окружения

### 2. Настройка переменных окружения
На хостинге установите переменные окружения:
- `BOT_TOKEN` - токен Telegram бота
- `ADMIN_IDS` - список ID администраторов через запятую

### 3. Запуск
```bash
# Установка зависимостей
pip install -r requirements.txt

# Запуск основного бота
python3 run.py
```

## Использование

### Для пользователей:
1. Отправьте `/start` боту
2. Выберите нужную опцию:
   - "1️⃣ Получить консультацию" - для консультации
   - "2️⃣ Создать психологическую карту" - для создания карты
3. При создании карты выберите тип карты из 15 доступных
4. Выберите тип опроса (базовый или расширенный)
5. Ответьте на вопросы
6. Получите результат и дождитесь модерации

### Для администраторов:
- `/admin` - открыть админ-панель
- `/pending` - показать карты на модерации
- Используйте кнопки для одобрения/отклонения карт
- Все сообщения пользователей автоматически отправляются администраторам

## База данных

Данные хранятся в JSON файле `database.json`:
- Состояния пользователей
- Психологические карты
- Статусы модерации
- Ответы пользователей

## Безопасность

- Все чувствительные данные хранятся в переменных окружения
- Проверка прав доступа для админских функций
- Поддержка множественных администраторов
- Модерация контента перед отправкой пользователям

## Логирование

Все действия логируются с указанием времени и уровня важности.

## Офлайн режим

Бот работает полностью офлайн:
- Локальная система ответов для консультаций
- Предустановленные психологические карты
- Не требует внешних API или интернет-соединения
- Быстрые ответы без задержек

## Скрипты управления

### Остановка бота:
```bash
./stop_bot.sh
```

### Перезапуск с мониторингом:
```bash
./restart_with_monitoring.sh
```

### Развертывание:
```bash
./deploy.sh
```

## Поддержка

При возникновении проблем проверьте:
1. Правильность токенов в переменных окружения
2. Логи приложения для диагностики ошибок
3. Права доступа администраторов
4. Состояние базы данных

## Устранение неполадок

### Ошибка "Conflict: terminated by other getUpdates request"
```bash
# Остановите все экземпляры бота
./stop_bot.sh

# Запустите заново
python3 run.py
```

### Бот не отвечает
1. Проверьте логи на ошибки
2. Убедитесь, что переменные окружения установлены
3. Перезапустите бота: `./stop_bot.sh && python3 run.py`
4. Проверьте права доступа администраторов

### Проблемы с модерацией
1. Убедитесь, что ADMIN_IDS правильно настроены
2. Проверьте, что администраторы добавлены в бота
3. Проверьте логи админской панели

## Особенности

- **Офлайн работа**: Бот не требует внешних API
- **15 психологических карт**: Разнообразие типов анализа
- **Множественные администраторы**: Поддержка команды модераторов
- **Автоматическая отправка**: Все сообщения пользователей отправляются администраторам
- **Быстрые ответы**: Локальная обработка без задержек
- **Гибкая настройка**: Легко добавлять новые карты и администраторов 
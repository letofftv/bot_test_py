# Психологический Telegram Бот

Telegram бот для психологических консультаций и создания психологических карт с использованием OpenAI GPT-4.

## Функциональность

### Для пользователей:
1. **Психологическая консультация** - получение профессиональной консультации от ИИ-психолога
2. **Создание психологической карты** - прохождение опроса и получение персональной психологической карты

### Для администратора:
- Модерация созданных карт
- Одобрение/отклонение карт
- Отправка результатов пользователям

## Структура проекта

```
bot_test_py/
├── app.py              # Основное приложение для Amvera (webhook)
├── main.py             # Локальная версия (polling)
├── admin.py            # Админская панель для модерации
├── config.py           # Конфигурация и настройки
├── database.py         # Работа с базой данных
├── openai_client.py    # Интеграция с OpenAI API
├── requirements.txt    # Зависимости Python
└── README.md          # Документация
```

## Установка и настройка

### 1. Установка зависимостей
```bash
pip install -r requirements.txt
```

### 2. Настройка переменных окружения

В Amvera необходимо установить следующие переменные окружения:

- `BOT_TOKEN` - токен Telegram бота
- `OPENAI_API_KEY` - ключ API OpenAI

### 3. Настройка доменов

В `config.py` указаны домены для Amvera:
- `INTERNAL_DOMAIN` - внутренний домен для webhook
- `EXTERNAL_DOMAIN` - внешний домен

## Развертывание на Amvera

### 1. Основное приложение
Используйте `app.py` для развертывания на Amvera. Файл содержит:
- Flask приложение для обработки webhook
- Автоматическая настройка webhook при запуске
- Health check endpoint

### 2. Локальная разработка
Для локальной разработки используйте `main.py`:
```bash
python main.py
```

### 3. Админская панель
Для модерации карт запустите отдельно:
```bash
python admin.py
```

## Использование

### Для пользователей:
1. Отправьте `/start` боту
2. Выберите нужную опцию:
   - "1️⃣ Получить консультацию" - для консультации
   - "2️⃣ Создать психологическую карту" - для создания карты

### Для администратора:
- `/admin` - открыть админ-панель
- `/pending` - показать карты на модерации
- Используйте кнопки для одобрения/отклонения карт

## База данных

Данные хранятся в JSON файле `database.json`:
- Состояния пользователей
- Психологические карты
- Статусы модерации

## Безопасность

- Все чувствительные данные хранятся в переменных окружения
- Проверка прав доступа для админских функций
- Модерация контента через OpenAI API

## Логирование

Все действия логируются с указанием времени и уровня важности.

## Поддержка

При возникновении проблем проверьте:
1. Правильность токенов в переменных окружения
2. Доступность OpenAI API
3. Логи приложения для диагностики ошибок 
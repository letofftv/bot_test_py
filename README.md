# Психологический Telegram Бот

Telegram бот для психологических консультаций и создания психологических карт с использованием OpenAI GPT-4.

## Функциональность

### Для пользователей:
1. **Психологическая консультация** - получение профессиональной консультации от ИИ-психолога
2. **Создание психологической карты** - прохождение опроса и получение персональной психологической карты

### Для администратора:
- Модерация созданных карт
- Одобрение/отклонение карт
- Отправка результатов пользователям

## Структура проекта

```
bot_test_py/
├── bot_polling.py        # Основной бот (polling) - РЕКОМЕНДУЕТСЯ
├── admin_polling.py      # Админская панель (polling)
├── app.py                # Версия с webhook для Amvera
├── admin.py              # Админская панель с webhook
├── main.py               # Локальная версия (polling)
├── config.py             # Конфигурация и настройки
├── database.py           # Работа с базой данных
├── openai_client.py      # Интеграция с OpenAI API
├── requirements.txt      # Зависимости Python
└── README.md            # Документация
```

## Установка и настройка

### 1. Установка зависимостей
```bash
pip install -r requirements.txt
```

### 2. Настройка переменных окружения

Создайте файл `.env` или установите переменные окружения:

```env
BOT_TOKEN=ваш_telegram_токен
OPENAI_API_KEY=ваш_openai_ключ
```

### 3. Запуск бота

#### Рекомендуемый способ (polling):
```bash
# Основной бот
python bot_polling.py

# Админская панель (в отдельном терминале)
python admin_polling.py
```

#### Альтернативные способы:
```bash
# Локальная версия
python main.py

# Webhook версия (для Amvera)
python app.py
```

## Использование

### Для пользователей:
1. Отправьте `/start` боту
2. Выберите нужную опцию:
   - "1️⃣ Получить консультацию" - для консультации
   - "2️⃣ Создать психологическую карту" - для создания карты

### Для администратора:
- `/admin` - открыть админ-панель
- `/pending` - показать карты на модерации
- Используйте кнопки для одобрения/отклонения карт

## Преимущества polling версии

✅ **Простота настройки** - не требует webhook URL  
✅ **Надежность** - работает везде, где есть интернет  
✅ **Отладка** - легче диагностировать проблемы  
✅ **Разработка** - удобно для локальной разработки  
✅ **Стабильность** - нет проблем с доменами и SSL  

## База данных

Данные хранятся в JSON файле `database.json`:
- Состояния пользователей
- Психологические карты
- Статусы модерации

## Безопасность

- Все чувствительные данные хранятся в переменных окружения
- Проверка прав доступа для админских функций
- Модерация контента через OpenAI API

## Логирование

Все действия логируются с указанием времени и уровня важности.

## Поддержка

При возникновении проблем проверьте:
1. Правильность токенов в переменных окружения
2. Доступность OpenAI API
3. Логи приложения для диагностики ошибок

## Рекомендации

Для продакшена рекомендуется использовать **polling версию** (`bot_polling.py`), так как она:
- Проще в настройке
- Надежнее работает
- Не требует настройки webhook
- Легче в отладке 